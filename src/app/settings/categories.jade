.panel.panel-default
  .panel-heading
    span.glyphicon.glyphicon-tags#left-icon
    span(translate='TITLES.CATEGORIES')
  .panel-body#with-background
    loading-directive
    .row(ng-model='categories.categories' ui-sortable='categories.sortable')
      // カテゴリの一覧
      .col-sm-3(ng-repeat='category in categories.categories' id='{{category.id}}')
        .panel.panel-body.col-sm-11.category-card(ng-show='!category.edit_field' ng-style="{'cursor': cursor_type}" ng-mouseenter="cursor_type = 'move'")
          a.pull-right
            span.glyphicon.glyphicon-trash#right-icon(ng-click='categories.destroyCategory($index)' ng-show='category.breakdowns_count == 0')
          div.category-name(ng-style="{'cursor': 'pointer'}" ng-click='categories.editCategory($index)')
            span.glyphicon.glyphicon-plus-sign.green#left-icon(ng-show='category.barance_of_payments')
            span.glyphicon.glyphicon-minus-sign.red#left-icon(ng-hide='category.barance_of_payments')
            span {{ category.name | truncate:true:12 }}
          hr
          a.label.label-info.label-list(href='' ng-click='categories.showBreakdowns($index)' tooltip="{{ 'TOOLTIPS.BREAKDOWNS' | translate }}")
            span.glyphicon.glyphicon-th-list#left-icon
            span {{ category.breakdowns_count }}

          a.label.label-info.label-list(href='' ng-click='categories.showPlaces($index)' tooltip="{{ 'TOOLTIPS.PLACES' | translate }}")

            span.glyphicon.glyphicon-map-marker#left-icon
            span {{ category.places_count }}
        .panel.panel-body.col-sm-11.category-card#category(ng-if="category.edit_field")
          .input-group
            .input-group-btn
              button.btn.btn-default(ng-class="{'btn-success': !category.edit_payments}" type='button' ng-click='category.edit_payments = false')
                span.glyphicon.glyphicon-minus-sign#left-icon
                span(translate='BUTTONS.OUTGO')
              button.btn.btn-default(ng-class="{'btn-info': category.edit_payments}" type='button' ng-click='category.edit_payments = true')
                span.glyphicon.glyphicon-plus-sign#left-icon
                span(translate='BUTTONS.INCOME')
          form.form-inline(novalidate=true name='editCategoryForm' ng-submit='categories.updateCategory($index)')
            input.category-form(name='name' ng-value='category.name' ng-init='category.edit_name = category.name' ng-model='category.edit_name' auto-focus=true type='text' required=true)
            button.btn.btn-success(translate='BUTTONS.EDIT' ng-disabled='editCategoryForm.$dirty && editCategoryForm.$invalid')
            a.btn.btn-default(translate='BUTTONS.CANCEL' ng-click='category.edit_field = false')
            span.errors(ng-messages='editCategoryForm.name.$error' ng-show='editCategoryForm.$dirty')
              div(ng-message='required')
                span.glyphicon.glyphicon-alert#left-icon
                span(translate='ERRORS.REQUIRED.CATEGORY_NAME')
              div(ng-message='maxlength')
                span.glyphicon.glyphicon-alert#left-icon
                span(translate='ERRORS.MAXLENGTH.CATEGORY_NAME')

      // カテゴリの追加フィールド
      .col-sm-3(ng-show='categories.categories && categories.categories.length < 20')
        .panel.panel-body.col-sm-11.category-plus#category(ng-click='categories.addNewPanel()' ng-class="{'panel-background': 'adding'}" ng-mouseenter="adding = true" ng-mouseleave="adding = false" ng-show="!categories.add_field")
          span.glyphicon.glyphicon-plus
        .panel.panel-body.col-sm-11.category-card#category(ng-if='categories.add_field')
          // 収入・支出
          .input-group
            .input-group-btn
              button.btn.btn-default(ng-class="{'btn-success': !categories.new_payments}" type='button' ng-click='categories.new_payments = false')
                span.glyphicon.glyphicon-minus-sign#left-icon
                span(translate='BUTTONS.OUTGO')
              button.btn.btn-default(ng-class="{'btn-info': categories.new_payments}" type='button' ng-click='categories.new_payments = true')
                span.glyphicon.glyphicon-plus-sign#left-icon
                span(translate='BUTTONS.INCOME')
          // 入力フォーム
          form.form-inline(novalidate=true name='newCategoryForm' ng-submit='categories.createCategory()')
            input.category-form(name='name' ng-model='categories.new_category_name' auto-focus=true type='text' required=true ng-maxlength='100')
            button.btn.btn-success(translate='BUTTONS.ADD' ng-disabled='newCategoryForm.$dirty && newCategoryForm.$invalid')
            a.btn.btn-default(translate='BUTTONS.CANCEL' ng-click='categories.add_field = false')
            span.errors(ng-messages='newCategoryForm.name.$error' ng-show='newCategoryForm.$dirty || newCategoryForm.$submitted')
              div(ng-message='required')
                span.glyphicon.glyphicon-alert#left-icon
                span(translate='ERRORS.REQUIRED.CATEGORY_NAME')
              div(ng-message='maxlength')
                span.glyphicon.glyphicon-alert#left-icon
                span(translate='ERRORS.MAXLENGTH.CATEGORY_NAME')
 
script#breakdowns(type='text/ng-template')
  .modal-body
    loading-directive(target='modal')
    div(id='breakdown.id' ng-repeat='breakdown in breakdowns.breakdowns')
      p(ng-click='breakdown.edit_field = true' ng-show='!breakdown.edit_field') {{ breakdown.name }}
      .form.form-inline(ng-if='breakdown.edit_field')
        input.form-control(type='text' ng-model='breakdown.edit_name' ng-value='breakdown.name' ng-init='breakdown.edit_name = breakdown.name' auto-focus=true ng-keydown='breakdowns.updateBreakdown($index, $event)')
        button.btn.btn-success(translate='BUTTONS.EDIT' ng-click='breakdowns.updateBreakdown($index)')
        button.btn.btn-default(translate='BUTTONS.CANCEL' ng-click='breakdown.edit_field = false')
        button.btn.btn-info.pull-right(href='' translate='LINKS.DELETE' ng-click='breakdowns.destroyBreakdown($index)')
    a(href='' ng-click='breakdowns.new_breakdown_field = true' translate='BUTTONS.ADD' ng-show='!breakdowns.new_breakdown_field && breakdowns.breakdowns')
    form(novalidate=true name='newBreakdownForm' ng-submit='breakdowns.submit()')
      .form-group(ng-if='breakdowns.new_breakdown_field')
        input.form-control(type='text' autofocus=true name='breakdowns.new-breakdown' ng-model='breakdowns.new_breakdown' required=true ng-maxlength='100' ng-keydown='breakdowns.createBreakdown($event)')

script#modal-places(type='text/ng-template')
  .modal-body
    loading-directive(target='modal')
    div(id='place.id' ng-repeat='place in modal_places.places')
      p {{ place.name }}
